@using Microsoft.AspNetCore.Http.Extensions
@using System.Text.Json
@using static TodoListApp.Models.TodoList.TodoAccessModel
@model TodoListApp.Models.WebApp.CommentsFromTaskWebModel

@{
	Layout = null;

	var returnUrl = Context.Request.GetEncodedUrl();
	var returnUrlUri = new Uri(returnUrl);
}

<div class="w-75">
	@if (Model.Comments.Any())
	{
		@foreach (var task in Model.Comments)
		{
			@await Html.PartialAsync("_CommentPartial.cshtml", task)
		}
	}
	else
	{
		<div class="bg-white rounded p-3 text-muted">No comments yet...</div>
	}

	<div class="d-flex justify-content-center">
		<div page-model="@Model.Pagination"
			 page-classes-enabled="true"
			 page-class="btn"
			 page-class-normal="btn-outline-dark"
			 page-class-selected="btn-primary"
			 page-action="ApplyFilterJson"
			 page-controller="Comment"
			 page-filter-name="@Model.FilterName" ,
			 page-return-url="@returnUrlUri"
			 page-filter-storage="comment-filter-storage">
		</div>
	</div>

	<input type="hidden" id="comment-filter-storage" value='@Html.Raw(JsonSerializer.Serialize(Model.Filter))' />

	@if (Model.AccessLevel == TodoRole.Editor || Model.AccessLevel == TodoRole.Owner)
	{
		<form asp-controller="Comment" asp-action="Create" method="post" class="mt-3">
			<input type="hidden" name="TaskId" value="@Model.TaskId" />
			<div class="mb-3">
				<label for="Content" class="form-label">Your comment</label>
				<textarea class="form-control" id="Content" name="Content" rows="3" placeholder="Write your comment here..." required></textarea>
			</div>
			<button type="submit" class="btn btn-primary d-inline-flex align-items-center">
				<i class="fas fa-comment-dots me-1"></i> Add Comment
			</button>
		</form>
	}
</div>


